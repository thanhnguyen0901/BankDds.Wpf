<UserControl
    x:Class="BankDds.Wpf.Views.TransactionsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:BankDds.Wpf.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="700"
    d:DesignWidth="1200"
    Background="White"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisConverter" />
    </UserControl.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock
            Grid.Row="0"
            Style="{StaticResource PageTitleStyle}"
            Text="Transaction Management" />

        <!--  Error Message  -->
        <Border
            Grid.Row="1"
            Margin="0,0,0,10"
            Padding="10"
            Background="#FFF3CD"
            BorderBrush="#FFC107"
            BorderThickness="1"
            CornerRadius="5"
            Visibility="{Binding HasError, Converter={StaticResource BoolToVisConverter}}">
            <TextBlock
                x:Name="ErrorMessage"
                FontWeight="SemiBold"
                Foreground="#856404"
                TextWrapping="Wrap" />
        </Border>

        <!--  Success Message  -->
        <StackPanel Grid.Row="2" Margin="0,0,0,10">
            <TextBlock
                Margin="0,0,0,5"
                FontWeight="SemiBold"
                Foreground="#388E3C"
                Text="{Binding SuccessMessage}">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SuccessMessage.Length, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SuccessMessage}" Value="">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SuccessMessage}" Value="{x:Null}">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </StackPanel>

        <TabControl Grid.Row="3" SelectedIndex="{Binding SelectedTabIndex}">
            <TabItem Header="Deposit/Withdraw">
                <Grid Margin="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="400" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Border
                        Grid.Column="0"
                        Padding="15"
                        Background="#F8F9FA"
                        BorderBrush="#DEE2E6"
                        BorderThickness="1"
                        CornerRadius="5">
                        <StackPanel>
                            <TextBlock Style="{StaticResource SectionTitleStyle}" Text="Transaction Details" />
                            <TextBlock Style="{StaticResource StandardLabelStyle}" Text="Account Number:" />
                            <TextBox
                                Margin="0,0,0,15"
                                Style="{StaticResource StandardTextBoxStyle}"
                                Text="{Binding SelectedAccountNumber, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Style="{StaticResource StandardLabelStyle}" Text="Amount:" />
                            <TextBox
                                Margin="0,0,0,5"
                                Style="{StaticResource StandardTextBoxStyle}"
                                Text="{Binding Amount, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock
                                Margin="0,0,0,15"
                                FontSize="11"
                                FontStyle="Italic"
                                Foreground="Gray"
                                Text="Min: 100K | Max Single: 50M | Daily Withdrawal Limit: 100M VND" />
                            <Button
                                x:Name="Deposit"
                                Margin="0,0,0,10"
                                Content="Deposit"
                                Style="{StaticResource SuccessButtonStyle}" />
                            <Button
                                x:Name="Withdraw"
                                Margin="0"
                                Content="Withdraw"
                                Style="{StaticResource DangerButtonStyle}" />
                        </StackPanel>
                    </Border>
                    <GroupBox
                        Grid.Column="2"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Header="Recent Transactions">
                        <DataGrid ItemsSource="{Binding RecentTransactions}" Style="{StaticResource StandardDataGridStyle}">
                            <DataGrid.Columns>
                                <DataGridTextColumn
                                    Width="90"
                                    Binding="{Binding MAGD}"
                                    Header="ID" />
                                <DataGridTextColumn
                                    Width="60"
                                    Binding="{Binding LOAIGD}"
                                    Header="Type" />
                                <DataGridTextColumn
                                    Width="90"
                                    Binding="{Binding NGAYGD, StringFormat=dd/MM/yyyy}"
                                    Header="Date" />
                                <DataGridTextColumn
                                    Width="110"
                                    Binding="{Binding SOTIEN, StringFormat=N0}"
                                    Header="Amount" />
                                <DataGridTextColumn
                                    Width="90"
                                    Binding="{Binding StatusDisplay}"
                                    Header="Status">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="Completed">
                                                    <Setter Property="Foreground" Value="#388E3C" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Failed">
                                                    <Setter Property="Foreground" Value="#D32F2F" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Pending">
                                                    <Setter Property="Foreground" Value="#FFA000" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn
                                    Width="*"
                                    Binding="{Binding ErrorMessage}"
                                    Header="Note">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#D32F2F" />
                                            <Setter Property="FontStyle" Value="Italic" />
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>
            <TabItem Header="Transfer">
                <Grid Margin="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="400" />
                        <ColumnDefinition Width="20" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Border
                        Grid.Column="0"
                        Padding="15"
                        Background="#F8F9FA"
                        BorderBrush="#DEE2E6"
                        BorderThickness="1"
                        CornerRadius="5">
                        <StackPanel>
                            <TextBlock Style="{StaticResource SectionTitleStyle}" Text="Transfer Details" />
                            <TextBlock Style="{StaticResource StandardLabelStyle}" Text="From Account:" />
                            <TextBox
                                Margin="0,0,0,15"
                                Style="{StaticResource StandardTextBoxStyle}"
                                Text="{Binding SelectedAccountNumber, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Style="{StaticResource StandardLabelStyle}" Text="To Account:" />
                            <TextBox
                                x:Name="TransferToAccount"
                                Margin="0,0,0,15"
                                Style="{StaticResource StandardTextBoxStyle}"
                                Text="{Binding TransferToAccount, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock Style="{StaticResource StandardLabelStyle}" Text="Amount:" />
                            <TextBox
                                Margin="0,0,0,5"
                                Style="{StaticResource StandardTextBoxStyle}"
                                Text="{Binding Amount, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBlock
                                Margin="0,0,0,15"
                                FontSize="11"
                                FontStyle="Italic"
                                Foreground="Gray"
                                Text="Min: 100K | Max: 50M | Daily Transfer Limit: 200M VND" />
                            <Button
                                x:Name="Transfer"
                                Margin="0"
                                Content="Transfer"
                                Style="{StaticResource WarningButtonStyle}" />
                        </StackPanel>
                    </Border>
                    <GroupBox
                        Grid.Column="2"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Header="Recent Transactions">
                        <DataGrid ItemsSource="{Binding RecentTransactions}" Style="{StaticResource StandardDataGridStyle}">
                            <DataGrid.Columns>
                                <DataGridTextColumn
                                    Width="90"
                                    Binding="{Binding MAGD}"
                                    Header="ID" />
                                <DataGridTextColumn
                                    Width="60"
                                    Binding="{Binding LOAIGD}"
                                    Header="Type" />
                                <DataGridTextColumn
                                    Width="80"
                                    Binding="{Binding NGAYGD, StringFormat=dd/MM/yyyy}"
                                    Header="Date" />
                                <DataGridTextColumn
                                    Width="100"
                                    Binding="{Binding SOTIEN, StringFormat=N0}"
                                    Header="Amount" />
                                <DataGridTextColumn
                                    Width="100"
                                    Binding="{Binding SOTK_NHAN}"
                                    Header="To Account" />
                                <DataGridTextColumn
                                    Width="90"
                                    Binding="{Binding StatusDisplay}"
                                    Header="Status">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="Completed">
                                                    <Setter Property="Foreground" Value="#388E3C" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Failed">
                                                    <Setter Property="Foreground" Value="#D32F2F" />
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Pending">
                                                    <Setter Property="Foreground" Value="#FFA000" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn
                                    Width="*"
                                    Binding="{Binding ErrorMessage}"
                                    Header="Note">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#D32F2F" />
                                            <Setter Property="FontStyle" Value="Italic" />
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </TabItem>
        </TabControl>

        <!--  Loading Overlay  -->
        <Grid
            Grid.Row="0"
            Grid.RowSpan="4"
            Style="{StaticResource LoadingOverlayStyle}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource LoadingSpinnerStyle}" />
                <TextBlock
                    Margin="0,10,0,0"
                    HorizontalAlignment="Center"
                    FontSize="14"
                    Foreground="White"
                    Text="Processing..." />
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
